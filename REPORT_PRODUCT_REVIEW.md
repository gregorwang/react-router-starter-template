# 产品功能深度评审

## 产品地图（路由与核心能力）
- 登录与登出：`/login`、`/logout`
- 主入口：`/` -> `/conversations`
- 历史记录：`/conversations`（按项目筛选 + 用量聚合）
- 对话页：`/c/:id`（模型选择、SSE 流式、记忆压缩、R2 归档）
- 操作接口：`/chat/action`、`/conversations/compact`、`/conversations/archive`、`/conversations/delete`、`/projects/create`
- 用量统计：`/usage`

## 主要用户流程
1) 登录 -> 进入历史记录 -> 新建对话 -> 选择模型 -> 发送消息 -> SSE 返回 -> 记录保存
2) 按项目切换对话 -> 统计用量 -> 单对话归档到 R2 或下载
3) 长对话自动压缩（auto-compact）+ 手动压缩

## 亮点与优势
- **多模型能力统一**：选择模型后可直接控制推理强度、思考预算、是否搜索等参数。
- **完整聊天链路**：流式输出 + D1 持久化 + 用量统计 + 归档下载已闭环。
- **项目维度管理**：支持项目切换与用量统计分组。
- **工程效率**：React Router 文件路由清晰，后端代码足够轻。

## 功能缺口（影响体验/可用性）
- **无“停止生成”按钮**：已有 `abort` 逻辑，但 UI 未暴露。
- **模型可用性不可见**：模型不可用时仅报错弹窗，缺少状态提示与禁用选项。
- **项目管理缺失**：只能 `prompt()` 创建，缺少编辑/删除/描述维护。
- **归档仅导出**：缺少从 R2 导入/恢复的能力。
- **删除对话无入口**：存在 `/conversations/delete` 接口但无 UI。
- **无搜索/筛选**：历史记录不支持关键词或时间筛选。

## UX 风险与可用性问题
- **自动滚动锁定**：用户无法在流式输出时阅读历史消息。
- **错误提示过于粗糙**：基本是 `alert()`，缺少内联错误提示与重试按钮。
- **多处页面语言不一致**：界面为中文，但 `<html lang="en">`；影响可访问性与 SEO。
- **首次发送可能丢消息**：`currentConversation` 为空时会先创建并返回，用户消息未发送。

## 建议优先级（产品层）
P0（立即）
- 增加“停止生成”按钮并与 `abortGeneration` 联动。
- 处理自动滚动：用户滚动到上方时暂停自动滚动，提供“回到底部”按钮。

P1（短期）
- 模型可用性提示与禁用：根据后端环境/Key 是否存在禁用选项。
- 项目管理页面：重命名、删除、描述编辑。

P2（中期）
- 归档恢复（导入 JSON -> 新对话）。
- 搜索与筛选：关键词 + 时间范围。

## 建议补充的指标
- 活跃对话数、日均消息数、每模型成本、平均响应时长、失败率。
- 归档成功率与下载次数，用于评估备份需求。
